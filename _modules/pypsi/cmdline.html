

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pypsi.cmdline &mdash; pypsi 1.2.1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="pypsi 1.2.1 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../index.html" class="fa fa-home"> pypsi</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/ameily/pypsi">Github</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pypi.python.org/pypi/pypsi">Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pypsi.tutorial.html">1. Pypsi Shell and Command Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../pypsi.tutorial.html#command-api">1.1. Command API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pypsi.tutorial.html#shell-api">1.2. Shell API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../pypsi.commands.html">Pypsi Builtin Commands</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../pypsi.plugins.html">Pypsi Builtin Plugins</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../pypsi.plugins.html#module-pypsi.plugins.block">Block Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pypsi.plugins.html#escape-sequence-processors">Escape Sequence Processors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pypsi.plugins.html#module-pypsi.plugins.history">Shell History</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pypsi.plugins.html#module-pypsi.plugins.variable">Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pypsi.plugins.html#module-pypsi.plugins.cmd">Cmd</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../pypsi.shell.html">2. pypsi.shell - Pypsi Shell</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../pypsi.base.html">pypsi.base - Base classes for pluggable features</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../pypsi.base.html#command-objects">Command objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pypsi.base.html#plugin-objects">Plugin objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pypsi.base.html#argument-parsing">Argument parsing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../pypsi.cmdline.html">pypsi.cmdline - User input processing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../pypsi.cmdline.html#commands-and-expressions">Commands and expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pypsi.cmdline.html#tokens">Tokens</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pypsi.cmdline.html#statements">Statements</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../pypsi.namespace.html">pypsi.namespace - Arbitrary attribute storage classes</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../pypsi.format.html">pypsi.format - Stream output formatting</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../pypsi.stream.html">3. pypsi.stream - File streams</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../pypsi.utils.html">pypsi.utils - Utility functions</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../pypsi.wizard.html">pypsi.wizard - Prompt Wizards</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../pypsi.demo.html">4. Pypsi Demo Shell</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">pypsi</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>pypsi.cmdline</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for pypsi.cmdline</h1><div class="highlight"><pre>
<span class="c">#</span>
<span class="c"># Copyright (c) 2014, Adam Meily</span>
<span class="c"># All rights reserved.</span>
<span class="c">#</span>
<span class="c"># Redistribution and use in source and binary forms, with or without modification,</span>
<span class="c"># are permitted provided that the following conditions are met:</span>
<span class="c">#</span>
<span class="c"># * Redistributions of source code must retain the above copyright notice, this</span>
<span class="c">#   list of conditions and the following disclaimer.</span>
<span class="c">#</span>
<span class="c"># * Redistributions in binary form must reproduce the above copyright notice, this</span>
<span class="c">#   list of conditions and the following disclaimer in the documentation and/or</span>
<span class="c">#   other materials provided with the distribution.</span>
<span class="c">#</span>
<span class="c"># * Neither the name of the {organization} nor the names of its</span>
<span class="c">#   contributors may be used to endorse or promote products derived from</span>
<span class="c">#   this software without specific prior written permission.</span>
<span class="c">#</span>
<span class="c"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND</span>
<span class="c"># ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED</span>
<span class="c"># WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span>
<span class="c"># DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR</span>
<span class="c"># ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span>
<span class="c"># (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span>
<span class="c"># LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON</span>
<span class="c"># ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<span class="c"># (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span>
<span class="c"># SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span class="c">#</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Classes used for parsing user input.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>


<span class="n">TokenContinue</span> <span class="o">=</span> <span class="mi">0</span>
<span class="sd">&#39;&#39;&#39;The token accepts more characters.&#39;&#39;&#39;</span>

<span class="n">TokenEnd</span> <span class="o">=</span> <span class="mi">1</span>
<span class="sd">&#39;&#39;&#39;The token does not accept the current character.&#39;&#39;&#39;</span>

<span class="n">TokenTerm</span> <span class="o">=</span> <span class="mi">2</span>
<span class="sd">&#39;&#39;&#39;The token is finished and the current character should not be processed again.&#39;&#39;&#39;</span>


<div class="viewcode-block" id="Token"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.Token">[docs]</a><span class="k">class</span> <span class="nc">Token</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Base class for all tokens.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :param int index: the starting index of this token</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>

</div>
<div class="viewcode-block" id="WhitespaceToken"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.WhitespaceToken">[docs]</a><span class="k">class</span> <span class="nc">WhitespaceToken</span><span class="p">(</span><span class="n">Token</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Whitespace token that can contain any number of whitespace characters.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">WhitespaceToken</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

<div class="viewcode-block" id="WhitespaceToken.add_char"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.WhitespaceToken.add_char">[docs]</a>    <span class="k">def</span> <span class="nf">add_char</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add a character to this token.</span>

<span class="sd">        :param str c: the current character</span>
<span class="sd">        :returns int: TokenEnd or TokenContinue</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\xa0</span><span class="s">&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">TokenContinue</span>
        <span class="k">return</span> <span class="n">TokenEnd</span>
</div>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;WhitespaceToken()&quot;</span>

</div>
<div class="viewcode-block" id="StringToken"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.StringToken">[docs]</a><span class="k">class</span> <span class="nc">StringToken</span><span class="p">(</span><span class="n">Token</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A string token. This token may be bound by matching quotes and/or contain</span>
<span class="sd">    escaped whitespace characters.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">quote</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :param str c: the current string or character</span>
<span class="sd">        :param str quote: the surrounding quotes, `None` if there isn&#39;t any</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">StringToken</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quote</span> <span class="o">=</span> <span class="n">quote</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">escape</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">open_quote</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s">&quot;&#39;&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">quote</span> <span class="o">=</span> <span class="n">c</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">open_quote</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">escape</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="n">c</span>

<div class="viewcode-block" id="StringToken.add_char"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.StringToken.add_char">[docs]</a>    <span class="k">def</span> <span class="nf">add_char</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add a character to this token.</span>

<span class="sd">        :param str c: the current character</span>
<span class="sd">        :returns int: TokenEnd or TokenContinue</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">TokenContinue</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">escape</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">quote</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">quote</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="n">c</span>
                <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="n">c</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">OperatorToken</span><span class="o">.</span><span class="n">Operators</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="n">c</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="n">c</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">quote</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">quote</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">TokenTerm</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">open_quote</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">escape</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="n">c</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">escape</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;;&#39;</span><span class="p">,</span> <span class="s">&#39;|&#39;</span><span class="p">,</span> <span class="s">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;&lt;&#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\xa0</span><span class="s">&#39;</span><span class="p">):</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">TokenEnd</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s">&quot;&#39;&quot;</span><span class="p">):</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">TokenEnd</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="n">c</span>

        <span class="k">return</span> <span class="n">ret</span>
</div>
    <span class="k">def</span> <span class="nf">combine_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="n">token</span><span class="o">.</span><span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">open_quote</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">open_quote</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">escape</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">escape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quote</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">quote</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;String( {quote}{text}{quote} )&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">quote</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">quote</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="OperatorToken"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.OperatorToken">[docs]</a><span class="k">class</span> <span class="nc">OperatorToken</span><span class="p">(</span><span class="n">Token</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    An operator token. An operator can consist of one or more repetitions of the</span>
<span class="sd">    same operator character. For example, the string &quot;&gt;&gt;&quot; would be parsed as one</span>
<span class="sd">    `OperatorToken`, whereas the string &quot;&lt;&gt;&quot; would be parsed as two separate</span>
<span class="sd">    `OperatorToken` objects.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">Operators</span> <span class="o">=</span> <span class="s">&#39;&lt;&gt;|&amp;;&#39;</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Valid operator characters.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">operator</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :param str operator: the operator</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">OperatorToken</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operator</span> <span class="o">=</span> <span class="n">operator</span>

<div class="viewcode-block" id="OperatorToken.add_char"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.OperatorToken.add_char">[docs]</a>    <span class="k">def</span> <span class="nf">add_char</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add a character to this token.</span>

<span class="sd">        :param str c: the current character</span>
<span class="sd">        :returns int: TokenEnd or TokenContinue</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operator</span> <span class="o">+=</span> <span class="n">c</span>
            <span class="k">return</span> <span class="n">TokenContinue</span>
        <span class="k">return</span> <span class="n">TokenEnd</span>
</div>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;OperatorToken( {} )&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_chain_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;&lt;&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>

</div>
<div class="viewcode-block" id="Statement"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.Statement">[docs]</a><span class="k">class</span> <span class="nc">Statement</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A parsed statement to be executed. A statement may contain the following:</span>

<span class="sd">    - Commands and arguments</span>
<span class="sd">    - I/O redirections</span>
<span class="sd">    - Command chaining</span>

<span class="sd">    Command chaining describes how multiple commands are executed sequentially.</span>
<span class="sd">    The chain operators can be one of the following:</span>

<span class="sd">    - **|** (pipe) - pass previous `stdout` to current `stdin` and stop the</span>
<span class="sd">      statement execution if a command fails</span>
<span class="sd">    - **||** (or) - only run the subsequent commands if the current command</span>
<span class="sd">      fails</span>
<span class="sd">    - **&amp;&amp;** (and) - only run subsequent commands if the current command</span>
<span class="sd">      succeeds</span>
<span class="sd">    - **;** (chain) - execute subsequent commands regardless of result</span>

<span class="sd">    Commands are considered to succeed if they return 0 and fail if they don&#39;t.</span>
<span class="sd">    See :meth:`pypsi.base.Command.run` for a more detailed description of</span>
<span class="sd">    command return codes.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :param StatementContext ctx: the current statement context</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c">#:current :class:`StatementContext` for this statement</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span> <span class="o">=</span> <span class="n">ctx</span>

        <span class="c">#:`list` of :class:`CommandParams` describing the commands</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmds</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c">#:`list` of chaining operators, `str`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ops</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

<div class="viewcode-block" id="Statement.__len__"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.Statement.__len__">[docs]</a>    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :returns int: the number of commands in this statement</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmds</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Statement.__iter__"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.Statement.__iter__">[docs]</a>    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :returns iter: an iterator for :attr:`cmds`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmds</span><span class="p">)</span>
</div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cmd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        (:class:`CommandParams`) the current command</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmds</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmds</span><span class="p">)</span> <span class="k">else</span> <span class="bp">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">op</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        (:class:`str`) the current chaining operator</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">)</span> <span class="k">else</span> <span class="bp">None</span>

<div class="viewcode-block" id="Statement.next"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.Statement.next">[docs]</a>    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Begin processing of the next command.</span>

<span class="sd">        :returns tuple: a `tuple` of :class:`CommandParams` and operator (`str`)</span>
<span class="sd">            defining the next command, and `(None, None)` if there are no more</span>
<span class="sd">            commands to execute</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmds</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmds</span><span class="p">)</span> <span class="k">else</span> <span class="bp">None</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">)</span> <span class="k">else</span> <span class="bp">None</span>
        <span class="p">)</span>

</div></div>
<span class="k">class</span> <span class="nc">IoRedirectionError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>


<div class="viewcode-block" id="StatementContext"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.StatementContext">[docs]</a><span class="k">class</span> <span class="nc">StatementContext</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Holds information about the current context of a statement. This class wraps</span>
<span class="sd">    the handling of I/O redirection and piping by setting the system streams</span>
<span class="sd">    to their appropriate values for a given command, and resetting them once the</span>
<span class="sd">    statement has finished executing.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipe</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stdout_state</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stderr_state</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>

        <span class="c">#: the :data:`sys.stdin` when the statement context was created</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backup_stdin</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span>

        <span class="c">#:(:class:`file`) the current `stdout` file object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>

        <span class="c">#:(:class:`file`) the current `stderr` file object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span>

        <span class="c">#:(:class:`file`) the current `stdin` file objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdin</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span>

<div class="viewcode-block" id="StatementContext.fork"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.StatementContext.fork">[docs]</a>    <span class="k">def</span> <span class="nf">fork</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Fork the context. This allows the new :class:`StatementContext` to run</span>
<span class="sd">        child commands under this context.</span>

<span class="sd">        :returns: (:class:`StatementContext`) the forked context</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="n">StatementContext</span><span class="p">()</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">stdin</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">backup_stdin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdin</span>
        <span class="c">#ctx.stdout = ctx.backup_stdout = self.stdout</span>
        <span class="c">#ctx.stderr = ctx.backup_stderr = self.stderr</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">prev</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">pipe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipe</span>
        <span class="k">return</span> <span class="n">ctx</span>
</div>
<div class="viewcode-block" id="StatementContext.setup_io"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.StatementContext.setup_io">[docs]</a>    <span class="k">def</span> <span class="nf">setup_io</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">op</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Setup the system streams to the correct file streams for the provided</span>
<span class="sd">        command parameters.</span>

<span class="sd">        :param pypsi.base.Command cmd: the current command</span>
<span class="sd">        :param CommandParams params: the command parameters</span>
<span class="sd">        :param str op: the current chaining operator</span>
<span class="sd">        :returns: 0 on success, -1 on error</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">prev_pipe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;|&#39;</span>
        <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">stdin_path</span><span class="p">:</span>
            <span class="c"># Setup stdin if redirecting from a file</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdin</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">stdin_path</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">IoRedirectionError</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">stdin_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">prev_pipe</span><span class="p">:</span>
            <span class="c"># Previous command&#39;s stdout needs to be piped to current command&#39;s</span>
            <span class="c"># stdin</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stdin</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">stream</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Reset stdin</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stdin</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_stdin</span>

        <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">stdout_path</span><span class="p">:</span>
            <span class="c"># Setup stdout if redirecting to a file</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">redirect</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">stdout_path</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">stdout_mode</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">IoRedirectionError</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">stdout_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="s">&#39;|&#39;</span><span class="p">:</span>
            <span class="c"># Next command is a pipe, redirect stdout to a buffer</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">redirect</span><span class="p">(</span><span class="n">StringIO</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Reset stdout</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">was_pipe</span><span class="o">=</span><span class="n">prev_pipe</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">stderr_path</span><span class="p">:</span>
            <span class="c"># Setup stderr if redirecting to a file</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">redirect</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">stderr_path</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">IoRedirectionError</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">stderr_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Reset stderr</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prev</span> <span class="o">=</span> <span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">op</span><span class="p">)</span>

        <span class="k">return</span> <span class="mi">0</span>
</div>
<div class="viewcode-block" id="StatementContext.reset_io"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.StatementContext.reset_io">[docs]</a>    <span class="k">def</span> <span class="nf">reset_io</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Resets the system streams to their original values. This should be</span>
<span class="sd">        called after a statement has finished executing.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stdout_state</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stderr_state</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdin</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_stdin</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_stdin</span>

        <span class="k">return</span> <span class="mi">0</span>

</div></div>
<div class="viewcode-block" id="CommandParams"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.CommandParams">[docs]</a><span class="k">class</span> <span class="nc">CommandParams</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Wrapper around a called command&#39;s parameters and information.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">stdout_path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">stdout_mode</span><span class="o">=</span><span class="s">&#39;w&#39;</span><span class="p">,</span>
                 <span class="n">stderr_path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">stdin_path</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c">#:(:class:`str`) name of the command</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="c">#:(:class:`list`) list of `str` arguments passed in by the user</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="c">#:(:class:`str`) path to `stdout` if redirecting to a file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdout_path</span> <span class="o">=</span> <span class="n">stdout_path</span>
        <span class="c">#:(:class:`str`) mode to pass to `open()` when opening the `stdout` redirection file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdout_mode</span> <span class="o">=</span> <span class="n">stdout_mode</span>
        <span class="c">#:(:class:`str`) path to `stderr` if redirecting to a file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stderr_path</span> <span class="o">=</span> <span class="n">stderr_path</span>
        <span class="c">#:(:class:`str`) path to `stdin` if redirecting from a file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdin_path</span> <span class="o">=</span> <span class="n">stdin_path</span>

</div>
<div class="viewcode-block" id="StatementSyntaxError"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.StatementSyntaxError">[docs]</a><span class="k">class</span> <span class="nc">StatementSyntaxError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Invalid statement syntax was entered.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :param str message: error message</span>
<span class="sd">        :param int index: index in the statement that caused the error</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;syntax error at {}: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="StatementParser"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.StatementParser">[docs]</a><span class="k">class</span> <span class="nc">StatementParser</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parses raw user input into a :class:`Statement`.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

<div class="viewcode-block" id="StatementParser.reset"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.StatementParser.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Reset parsing state.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="StatementParser.process"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.StatementParser.process">[docs]</a>    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Process a single character of input.</span>

<span class="sd">        :param int index: current character index</span>
<span class="sd">        :param str c: current character</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">:</span>
            <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">add_char</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="n">TokenEnd</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="n">TokenTerm</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\xa0</span><span class="s">&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">WhitespaceToken</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s">&#39;|&#39;</span><span class="p">,</span> <span class="s">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s">&#39;;&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">OperatorToken</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">StringToken</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="StatementParser.tokenize"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.StatementParser.tokenize">[docs]</a>    <span class="k">def</span> <span class="nf">tokenize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Transform a `str` into a `list` of :class:`Token` objects.</span>

<span class="sd">        :param str line: the line of text to tokenize</span>
<span class="sd">        :returns: `list` of :class:`Token` objects</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">,</span> <span class="n">StringToken</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">escape</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span>
</div>
<div class="viewcode-block" id="StatementParser.clean_escapes"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.StatementParser.clean_escapes">[docs]</a>    <span class="k">def</span> <span class="nf">clean_escapes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokens</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Remove all escape sequences.</span>

<span class="sd">        :param list tokens: :class:`Token` objects to remove escape sequences</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">StringToken</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">token</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="n">token</span><span class="o">.</span><span class="n">quote</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">text</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="n">escape</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">escape</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="n">c</span>
                    <span class="n">escape</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">:</span>
                    <span class="n">escape</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="n">c</span>

            <span class="n">token</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
</div>
<div class="viewcode-block" id="StatementParser.condense"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.StatementParser.condense">[docs]</a>    <span class="k">def</span> <span class="nf">condense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokens</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Condenses sequential like :class:`Token` objects into a single</span>
<span class="sd">        :class:`Token` of the same type. For example, two sequential</span>
<span class="sd">        :class:`StringToken` objects will be concatenated into a single</span>
<span class="sd">        :class:`StringToken`.</span>

<span class="sd">        :param list tokens: :class:`Token` objects to condense</span>
<span class="sd">        :returns: condensed `list` of :class:`Token` objects</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">prev</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">condensed</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">StringToken</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prev</span><span class="p">,</span> <span class="n">StringToken</span><span class="p">):</span>
                    <span class="c">#prev.text += token.text</span>
                    <span class="n">prev</span><span class="o">.</span><span class="n">combine_token</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
                    <span class="n">token</span> <span class="o">=</span> <span class="n">prev</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">condensed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">WhitespaceToken</span><span class="p">):</span>
                <span class="n">condensed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
            <span class="n">prev</span> <span class="o">=</span> <span class="n">token</span>

        <span class="k">return</span> <span class="n">condensed</span>
</div>
<div class="viewcode-block" id="StatementParser.build"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.StatementParser.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokens</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create a :class:`Statement` object from tokenized input and statement</span>
<span class="sd">        context. This method will first remove all remaining escape sequences</span>
<span class="sd">        and then :meth:`condense` all the tokens before building the statement.</span>

<span class="sd">        :param list tokens: list of :class:`Token` objects to process as a</span>
<span class="sd">            statement</span>
<span class="sd">        :param pypsi.cmdline.StatementContext ctx: the current statement context to use</span>
<span class="sd">        :raises: :class:`StatementSyntaxError` on error</span>
<span class="sd">        :returns: (:class:`Statement`) the parsed statement</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">statement</span> <span class="o">=</span> <span class="n">Statement</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clean_escapes</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">condense</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cmd</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prev</span><span class="p">,</span> <span class="n">OperatorToken</span><span class="p">)</span> <span class="ow">and</span> <span class="n">prev</span><span class="o">.</span><span class="n">operator</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s">&#39;&gt;&gt;&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">StringToken</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">prev</span><span class="o">.</span><span class="n">operator</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;&gt;&gt;&#39;</span><span class="p">):</span>
                            <span class="n">cmd</span><span class="o">.</span><span class="n">stdout_path</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">text</span>
                        <span class="k">elif</span> <span class="n">prev</span><span class="o">.</span><span class="n">operator</span> <span class="o">==</span> <span class="s">&#39;&lt;&#39;</span><span class="p">:</span>
                            <span class="n">cmd</span><span class="o">.</span><span class="n">stdin_path</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">text</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">StatementSyntaxError</span><span class="p">(</span>
                            <span class="n">message</span><span class="o">=</span><span class="s">&quot;unexpected token: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">token</span><span class="p">)),</span>
                            <span class="n">index</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">index</span>
                        <span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">StringToken</span><span class="p">):</span>
                    <span class="n">cmd</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">OperatorToken</span><span class="p">):</span>
                    <span class="n">done</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">operator</span> <span class="o">==</span> <span class="s">&#39;||&#39;</span><span class="p">:</span>
                        <span class="n">statement</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;||&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">operator</span> <span class="o">==</span> <span class="s">&#39;&amp;&amp;&#39;</span><span class="p">:</span>
                        <span class="n">statement</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&amp;&amp;&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">operator</span> <span class="o">==</span> <span class="s">&#39;;&#39;</span><span class="p">:</span>
                        <span class="n">statement</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">operator</span> <span class="o">==</span> <span class="s">&#39;|&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">cmd</span><span class="o">.</span><span class="n">stdout_path</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">StatementSyntaxError</span><span class="p">(</span>
                                <span class="n">message</span><span class="o">=</span><span class="s">&quot;unexpected token: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">token</span><span class="p">)),</span>
                                <span class="n">index</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">index</span>
                            <span class="p">)</span>

                        <span class="n">statement</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;|&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">operator</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;&gt;&gt;&#39;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">cmd</span><span class="o">.</span><span class="n">stdout_path</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">StatementSyntaxError</span><span class="p">(</span>
                                <span class="n">message</span><span class="o">=</span><span class="s">&quot;unexpected token: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">token</span><span class="p">)),</span>
                                <span class="n">index</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">index</span>
                            <span class="p">)</span>

                        <span class="n">cmd</span><span class="o">.</span><span class="n">stdout_mode</span> <span class="o">=</span> <span class="s">&#39;w&#39;</span> <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">operator</span> <span class="o">==</span> <span class="s">&#39;&gt;&#39;</span> <span class="k">else</span> <span class="s">&#39;a&#39;</span>
                        <span class="n">done</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">operator</span> <span class="o">==</span> <span class="s">&#39;&lt;&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">cmd</span><span class="o">.</span><span class="n">stdin_path</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">StatementSyntaxError</span><span class="p">(</span>
                                <span class="n">message</span><span class="o">=</span><span class="s">&quot;unexpected token: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">token</span><span class="p">)),</span>
                                <span class="n">index</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">index</span>
                            <span class="p">)</span>

                        <span class="k">if</span> <span class="n">statement</span><span class="o">.</span><span class="n">ops</span> <span class="ow">and</span> <span class="n">statement</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;|&#39;</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">StatementSyntaxError</span><span class="p">(</span>
                                <span class="n">message</span><span class="o">=</span><span class="s">&quot;unexpected token: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">token</span><span class="p">)),</span>
                                <span class="n">index</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">index</span>
                            <span class="p">)</span>

                        <span class="n">cmd</span><span class="o">.</span><span class="n">stdin_path</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                        <span class="n">done</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">StatementSyntaxError</span><span class="p">(</span>
                            <span class="n">message</span><span class="o">=</span><span class="s">&quot;unknown operator: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">operator</span><span class="p">),</span>
                            <span class="n">index</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">index</span>
                        <span class="p">)</span>

                    <span class="k">if</span> <span class="n">done</span><span class="p">:</span>
                        <span class="n">statement</span><span class="o">.</span><span class="n">cmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
                        <span class="n">cmd</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">StringToken</span><span class="p">):</span>
                    <span class="n">cmd</span> <span class="o">=</span> <span class="n">CommandParams</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">WhitespaceToken</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">StatementSyntaxError</span><span class="p">(</span>
                        <span class="n">message</span><span class="o">=</span><span class="s">&quot;unexpected token: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">token</span><span class="p">)),</span>
                        <span class="n">index</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">index</span>
                    <span class="p">)</span>
            <span class="n">prev</span> <span class="o">=</span> <span class="n">token</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prev</span><span class="p">,</span> <span class="n">StringToken</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">prev</span><span class="p">,</span> <span class="n">OperatorToken</span><span class="p">)</span> <span class="ow">and</span> <span class="n">prev</span><span class="o">.</span><span class="n">operator</span> <span class="o">==</span> <span class="s">&#39;;&#39;</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">prev</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">StatementSyntaxError</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="s">&quot;unexpected token: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">prev</span><span class="p">)),</span>
                <span class="n">index</span><span class="o">=</span><span class="n">prev</span><span class="o">.</span><span class="n">index</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">cmd</span><span class="p">:</span>
            <span class="n">statement</span><span class="o">.</span><span class="n">cmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">statement</span>

</div></div>
<div class="viewcode-block" id="Expression"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.Expression">[docs]</a><span class="k">class</span> <span class="nc">Expression</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Holds a string-based expression in the form of ``operand operator value``.</span>
<span class="sd">    This class makes parsing expressions that may be in a single string or a</span>
<span class="sd">    list of strings. For example, the :class:`pypsi.plugins.VarCommand` command</span>
<span class="sd">    accepts input in the form of: ``name = value``. This class allows for the</span>
<span class="sd">    user to input any of the following lines and the same Expression object</span>
<span class="sd">    would be created, regardless of how the input lines are tokenized:</span>

<span class="sd">    - ``some_var = 2`` =&gt; ``[&#39;some_var&#39;, &#39;=&#39;, &#39;2&#39;]``</span>
<span class="sd">    - ``some_var= 2`` =&gt; ``[&#39;some_var=&#39;, &#39;2&#39;]``</span>
<span class="sd">    - ``some_var =2`` =&gt; ``[&#39;some_var&#39;, &#39;=2&#39;]``</span>
<span class="sd">    - ``some_var=2`` =&gt; ``[&#39;some_var=2&#39;]``</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">Operators</span> <span class="o">=</span> <span class="s">&#39;-+=/*&#39;</span>
    <span class="n">Whitespace</span> <span class="o">=</span> <span class="s">&#39; </span><span class="se">\t</span><span class="s">&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operand</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operand</span> <span class="o">=</span> <span class="n">operand</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operator</span> <span class="o">=</span> <span class="n">operator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;{} {} {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operand</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Expression.parse"><a class="viewcode-back" href="../../pypsi.cmdline.html#pypsi.cmdline.Expression.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create an Expression from a list of strings.</span>

<span class="sd">        :param list args: arguments</span>
<span class="sd">        :returns: a tuple of ``(remaining, expression)``, where ``remaining`` is</span>
<span class="sd">            the list of remaining string arguments of ``args`` after parsing has</span>
<span class="sd">            completed, and ``expression`` in the parsed :class:`Expression`, or</span>
<span class="sd">            :const:`None` if the expression is invalid.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="s">&#39;operand&#39;</span>
        <span class="n">operand</span> <span class="o">=</span> <span class="n">operator</span> <span class="o">=</span> <span class="n">value</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">done</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">remaining</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">arg</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="s">&#39;operand&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">Expression</span><span class="o">.</span><span class="n">Whitespace</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">operand</span><span class="p">:</span>
                            <span class="n">state</span> <span class="o">=</span> <span class="s">&#39;operator&#39;</span>
                    <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">Expression</span><span class="o">.</span><span class="n">Operators</span><span class="p">:</span>
                        <span class="n">state</span> <span class="o">=</span> <span class="s">&#39;operator&#39;</span>
                        <span class="n">operator</span> <span class="o">=</span> <span class="n">c</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">operand</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="n">operand</span> <span class="o">=</span> <span class="n">c</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">operand</span> <span class="o">+=</span> <span class="n">c</span>
                <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="s">&#39;operator&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">Expression</span><span class="o">.</span><span class="n">Operators</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">operator</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="n">operator</span> <span class="o">=</span> <span class="n">c</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">operator</span> <span class="o">+=</span> <span class="n">c</span>
                    <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">Expression</span><span class="o">.</span><span class="n">Whitespace</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">operator</span><span class="p">:</span>
                            <span class="n">state</span> <span class="o">=</span> <span class="s">&#39;value&#39;</span>
                            <span class="n">done</span> <span class="o">=</span> <span class="bp">True</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">state</span> <span class="o">=</span> <span class="s">&#39;value&#39;</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">c</span>
                        <span class="n">done</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="s">&#39;value&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">Expression</span><span class="o">.</span><span class="n">Whitespace</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="n">done</span> <span class="o">=</span> <span class="bp">True</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="n">c</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">value</span> <span class="o">+=</span> <span class="n">c</span>
            <span class="n">remaining</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">done</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="n">operator</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">done</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">remaining</span><span class="p">,</span> <span class="n">Expression</span><span class="p">(</span><span class="n">operand</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
</pre></div></div></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Adam Meily.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.2.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>